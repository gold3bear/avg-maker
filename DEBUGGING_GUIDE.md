# è°ƒè¯•æŒ‡å—ï¼šäº¤é€šç¯å…³é—­å’Œå¼ºåˆ¶åˆ·æ–°æ•°æ®æ¢å¤

## ğŸš¨ å½“å‰é—®é¢˜

1. **äº¤é€šç¯å…³é—­æŒ‰é’®æ— å“åº”**ï¼šç‚¹å‡»çº¢è‰²å…³é—­æŒ‰é’®æ— æ³•æ­£å¸¸å…³é—­ç¨‹åº
2. **å¼ºåˆ¶åˆ·æ–°æ•°æ®ä¸¢å¤±**ï¼šå³ä½¿æœ‰VS Codeé£æ ¼çš„æ•°æ®æ¢å¤ï¼Œå¼ºåˆ¶åˆ·æ–°åæ•°æ®ä»è¢«æ¸…ç©º

## ğŸ” è°ƒè¯•å·¥å…·

æˆ‘å·²ç»åœ¨ä»£ç ä¸­æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œç°åœ¨å¯ä»¥é€šè¿‡æ§åˆ¶å°è¿½è¸ªé—®é¢˜ã€‚

### å¯åŠ¨è°ƒè¯•æ¨¡å¼

```bash
npm run dev
```

ç„¶åæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºã€‚

## ğŸ¯ æµ‹è¯•åœºæ™¯å’Œé¢„æœŸæ—¥å¿—

### åœºæ™¯1ï¼šæµ‹è¯•äº¤é€šç¯å…³é—­æŒ‰é’®

**æ“ä½œæ­¥éª¤**ï¼š
1. å¯åŠ¨åº”ç”¨
2. ç‚¹å‡»å·¦ä¸Šè§’çº¢è‰²äº¤é€šç¯ï¼ˆå…³é—­æŒ‰é’®ï¼‰
3. è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º

**é¢„æœŸçš„è°ƒè¯•æ—¥å¿—åºåˆ—**ï¼š
```
ğŸ”´ TitleBar: å…³é—­æŒ‰é’®è¢«ç‚¹å‡»
ğŸ”´ TitleBar: è°ƒç”¨closeWindow API
ğŸ”´ Main: æ”¶åˆ°å…³é—­çª—å£è¯·æ±‚
ğŸ”´ Main: è°ƒç”¨mainWindow.close()
ğŸšª Main: çª—å£å…³é—­äº‹ä»¶è§¦å‘, isQuitting = false
ğŸšª Main: é˜»æ­¢é»˜è®¤å…³é—­ï¼Œé€šçŸ¥æ¸²æŸ“è¿›ç¨‹æ£€æŸ¥æœªä¿å­˜æ–‡ä»¶...
ğŸšª Main: å‘é€app-will-closeäº‹ä»¶åˆ°æ¸²æŸ“è¿›ç¨‹
ğŸšª App: æ”¶åˆ°åº”ç”¨å³å°†å…³é—­é€šçŸ¥ï¼Œæ£€æŸ¥æœªä¿å­˜çš„æ–‡ä»¶...
ğŸšª App: æœªä¿å­˜æ–‡ä»¶æ£€æŸ¥ç»“æœ: false
âœ… App: æ²¡æœ‰æœªä¿å­˜æ–‡ä»¶ï¼Œç›´æ¥å…³é—­
ğŸšª App: é€šçŸ¥ä¸»è¿›ç¨‹ç¡®è®¤å…³é—­
ğŸšª Main: æ¸²æŸ“è¿›ç¨‹ç¡®è®¤å…³é—­çª—å£
ğŸšª Main: çª—å£å…³é—­äº‹ä»¶è§¦å‘, isQuitting = true
ğŸšª Main: å·²ç¡®è®¤å…³é—­ï¼Œå…è®¸å…³é—­
```

**å¦‚æœæ—¥å¿—ä¸­æ–­ï¼Œè¯´æ˜é—®é¢˜å‡ºç°åœ¨é‚£ä¸ªæ­¥éª¤**ã€‚

### åœºæ™¯2ï¼šæµ‹è¯•å¼ºåˆ¶åˆ·æ–°æ•°æ®æ¢å¤

**æ“ä½œæ­¥éª¤**ï¼š
1. å¯åŠ¨åº”ç”¨å¹¶è¿›è¡Œä¸€äº›æ“ä½œï¼š
   - æ‰“å¼€é¡¹ç›®
   - åˆ‡æ¢è§†å›¾æ¨¡å¼
   - è°ƒæ•´ä¾§è¾¹æ 
2. ç­‰å¾…2-3ç§’ï¼ˆç¡®ä¿æ•°æ®è¢«ä¿å­˜ï¼‰
3. æŒ‰Cmd+Rå¼ºåˆ¶åˆ·æ–°
4. è§‚å¯Ÿé¡µé¢é‡æ–°åŠ è½½åçš„æ§åˆ¶å°è¾“å‡º

**é¢„æœŸçš„è°ƒè¯•æ—¥å¿—åºåˆ—**ï¼š
```
ğŸ’¾ å·¥ä½œåŒºçŠ¶æ€å·²ä¿å­˜
ğŸ’¾ ç¼–è¾‘å™¨çŠ¶æ€å·²ä¿å­˜
ğŸ” æ¢å¤æ£€æµ‹: æŸ¥æ‰¾çŠ¶æ€å¿«ç…§... æ‰¾åˆ°
ğŸ” æ¢å¤æ£€æµ‹: å¿«ç…§æ•°æ® {
  savedSessionId: "session_1234...",
  currentSessionId: "session_5678...",
  timeDiff: 1234,
  timestamp: "2025-01-28 10:30:45"
}
ğŸ” æ¢å¤æ£€æµ‹: åˆ¤æ–­ç»“æœ {
  recentlySaved: true,
  differentSession: true,
  shouldRestore: true
}
ğŸ”„ VS Codeé£æ ¼æ¢å¤ï¼šæ£€æµ‹åˆ°éœ€è¦æ¢å¤çš„çŠ¶æ€
ğŸ¨ æ¢å¤UIçŠ¶æ€: {view: "preview", activeTab: "explorer", sidebarVisible: true}
ğŸ“ æ¢å¤ç¼–è¾‘å™¨çŠ¶æ€: {...}
ğŸ“ æ¢å¤å·¥ä½œåŒºçŠ¶æ€: {...}
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šäº¤é€šç¯æŒ‰é’®ç‚¹å‡»æ— å“åº”

**å¯èƒ½åŸå› **ï¼š
- TitleBarç»„ä»¶ä¸­çš„äº‹ä»¶å¤„ç†å™¨æœªç»‘å®š
- inkAPIä¸å¯ç”¨
- IPCé€šä¿¡å¤±è´¥

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. çœ‹æ˜¯å¦æœ‰ `ğŸ”´ TitleBar: å…³é—­æŒ‰é’®è¢«ç‚¹å‡»` æ—¥å¿—
2. å¦‚æœæ²¡æœ‰ï¼Œæ£€æŸ¥æŒ‰é’®çš„onClickç»‘å®š
3. å¦‚æœæœ‰ä½†åç»­ä¸­æ–­ï¼Œæ£€æŸ¥inkAPIå¯ç”¨æ€§

### é—®é¢˜2ï¼šçª—å£å…³é—­æµç¨‹ä¸­æ–­

**å¯èƒ½åŸå› **ï¼š
- ä¸»è¿›ç¨‹IPCå¤„ç†å™¨æœªæ­£ç¡®æ³¨å†Œ
- æ¸²æŸ“è¿›ç¨‹ç›‘å¬å™¨æœªç»‘å®š
- ç¡®è®¤å…³é—­é€»è¾‘æœ‰é—®é¢˜

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. ç¡®è®¤æ˜¯å¦æ”¶åˆ° `ğŸšª Main: æ”¶åˆ°å…³é—­çª—å£è¯·æ±‚`
2. æ£€æŸ¥æ˜¯å¦æœ‰ `ğŸšª App: æ”¶åˆ°åº”ç”¨å³å°†å…³é—­é€šçŸ¥`
3. éªŒè¯confirmCloseæ˜¯å¦è¢«è°ƒç”¨

### é—®é¢˜3ï¼šå¼ºåˆ¶åˆ·æ–°åæ•°æ®ä¸æ¢å¤

**å¯èƒ½åŸå› **ï¼š
- æ•°æ®ä¿å­˜é¢‘ç‡ä¸å¤Ÿ
- æ¢å¤æ£€æµ‹é€»è¾‘é”™è¯¯
- localStorageè¢«æ¸…ç©º
- sessionIdåˆ¤æ–­é—®é¢˜

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. åˆ·æ–°å‰æ£€æŸ¥localStorageä¸­æ˜¯å¦æœ‰æ•°æ®ï¼š
   ```javascript
   console.log(Object.keys(localStorage).filter(k => k.startsWith('avg-master')));
   ```
2. æŸ¥çœ‹æ¢å¤æ£€æµ‹æ—¥å¿—ä¸­çš„æ—¶é—´å·®å’ŒsessionId
3. ç¡®è®¤ `shouldRestore()` è¿”å›å€¼

## ğŸ”§ æ‰‹åŠ¨è°ƒè¯•å‘½ä»¤

åœ¨æ§åˆ¶å°ä¸­è¿è¡Œè¿™äº›å‘½ä»¤æ¥æ‰‹åŠ¨æ£€æŸ¥çŠ¶æ€ï¼š

### æ£€æŸ¥å­˜å‚¨çš„æ•°æ®
```javascript
// æŸ¥çœ‹æ‰€æœ‰ç›¸å…³å­˜å‚¨
Object.keys(localStorage).filter(k => k.startsWith('avg-master')).forEach(key => {
  console.log(key + ':', localStorage.getItem(key));
});

// æŸ¥çœ‹çŠ¶æ€å¿«ç…§
console.log('Snapshot:', localStorage.getItem('avg-master-state-snapshot'));
```

### æ‰‹åŠ¨è§¦å‘æ¢å¤æ£€æµ‹
```javascript
// å¦‚æœcrashRecoveryå®ä¾‹å¯è®¿é—®
console.log('Should restore:', crashRecovery.shouldRestore());
console.log('Workspace state:', crashRecovery.restoreWorkspaceState());
console.log('Editor state:', crashRecovery.restoreEditorState());
console.log('UI state:', crashRecovery.restoreUIState());
```

### æµ‹è¯•APIå¯ç”¨æ€§
```javascript
// æ£€æŸ¥inkAPI
console.log('inkAPI available:', !!window.inkAPI);
console.log('closeWindow available:', !!window.inkAPI?.closeWindow);
console.log('onAppWillClose available:', !!window.inkAPI?.onAppWillClose);
```

## ğŸ“Š é¢„æœŸç»“æœ

### æ­£å¸¸å·¥ä½œçš„è¿¹è±¡
- [ ] ç‚¹å‡»äº¤é€šç¯åçœ‹åˆ°å®Œæ•´çš„å…³é—­æ—¥å¿—åºåˆ—
- [ ] çª—å£èƒ½æ­£å¸¸å…³é—­
- [ ] å¼ºåˆ¶åˆ·æ–°åçœ‹åˆ°æ¢å¤æ£€æµ‹æ—¥å¿—
- [ ] UIçŠ¶æ€å®Œå…¨æ¢å¤ï¼ˆè§†å›¾ã€ä¾§è¾¹æ ç­‰ï¼‰
- [ ] localStorageä¸­æœ‰æŒç»­æ›´æ–°çš„æ•°æ®

### å¼‚å¸¸æƒ…å†µ
- [ ] æ—¥å¿—åºåˆ—ä¸­æ–­
- [ ] é”™è¯¯æ—¥å¿—å‡ºç°
- [ ] æ¢å¤æ£€æµ‹è¿”å›false
- [ ] localStorageä¸ºç©ºæˆ–è¿‡æœŸ

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

æ ¹æ®æ§åˆ¶å°è¾“å‡ºçš„è°ƒè¯•æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥ç²¾ç¡®å®šä½é—®é¢˜æ‰€åœ¨ï¼š

1. **å¦‚æœäº¤é€šç¯æ—¥å¿—æ­£å¸¸ä½†çª—å£ä¸å…³é—­**ï¼šæ£€æŸ¥ä¸»è¿›ç¨‹çš„çª—å£å…³é—­é€»è¾‘
2. **å¦‚æœæ²¡æœ‰æ¢å¤æ£€æµ‹æ—¥å¿—**ï¼šæ£€æŸ¥useEffectä¾èµ–å’Œæ‰§è¡Œæ—¶æœº
3. **å¦‚æœæ¢å¤æ£€æµ‹ä¸ºfalse**ï¼šæ£€æŸ¥æ—¶é—´çª—å£å’ŒsessionIdé€»è¾‘
4. **å¦‚æœæœ‰æ¢å¤æ—¥å¿—ä½†çŠ¶æ€æ²¡æ¢å¤**ï¼šæ£€æŸ¥çŠ¶æ€è®¾ç½®é€»è¾‘

ç°åœ¨è¯·è¿è¡Œ `npm run dev` å¹¶æŒ‰ç…§ä¸Šè¿°åœºæ™¯è¿›è¡Œæµ‹è¯•ï¼Œç„¶åå‘Šè¯‰æˆ‘æ§åˆ¶å°çš„å…·ä½“è¾“å‡ºï¼