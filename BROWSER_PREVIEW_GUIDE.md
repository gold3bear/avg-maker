# AVG Maker 浏览器预览功能使用指南

## 功能概述

AVG Maker 现在支持在浏览器中预览故事，让您可以：
- 在任何浏览器中查看故事预览
- 与他人分享预览链接
- 在移动设备上查看故事
- 进行跨平台测试

## 使用方法

### 1. 启动开发服务器
```bash
npm run dev
```

### 2. 在主界面中操作
1. 打开或创建一个 `.ink` 故事文件
2. 在标题栏中找到以下按钮：
   - 🌐 **浏览器预览按钮**：直接在浏览器中打开预览
   - 📋 **复制URL按钮**：复制预览地址到剪贴板

### 3. 浏览器访问
- **直接访问**：打开浏览器访问 `http://localhost:3001/preview`
- **点击按钮**：使用标题栏的浏览器预览按钮
- **分享链接**：复制URL分享给他人

## 预览页面功能

浏览器预览页面包含：
- **故事标题栏**：显示当前加载的文件名
- **状态指示器**：显示加载状态和当前文件
- **故事内容区**：显示故事文本和选择项
- **交互式选择**：点击选择项继续故事

## 自动同步

当您在主应用中：
- 切换到不同的 `.ink` 文件
- 浏览器预览会自动更新显示新文件
- 无需手动刷新浏览器页面

## 技术特性

### 安全性
- 仅在开发环境中启用
- 本地网络访问，不对外网暴露
- 不会泄露敏感信息

### 兼容性
- 支持所有现代浏览器
- 支持移动设备浏览器
- 自适应响应式设计

### 性能
- 实时编译 Ink 脚本
- 自动缓存已编译内容
- 2秒间隔检查文件更新

## 故障排除

### 预览页面空白
- 确保开发服务器正在运行
- 检查控制台是否有错误信息
- 确认已选择了有效的 `.ink` 文件

### 无法访问预览服务器
- 确认端口 3001 未被占用
- 检查防火墙设置
- 查看 Electron 控制台输出

### 文件更新不同步
- 等待2秒自动检查间隔
- 手动刷新浏览器页面
- 重新启动开发服务器

## API 端点

预览服务器提供以下API：

### 获取当前文件
```
GET /api/current-file
```
返回当前正在预览的文件路径。

### 设置预览文件
```
POST /api/set-file
Content-Type: application/json

{
  "filePath": "/path/to/story.ink"
}
```

### 读取文件内容
```
POST /api/read-file
Content-Type: application/json

{
  "filePath": "/path/to/story.ink"
}
```

### 编译 Ink 脚本
```
POST /api/compile-ink
Content-Type: application/json

{
  "source": "Ink source code",
  "lintOnly": false,
  "sourceFilePath": "/path/to/story.ink"
}
```

## 注意事项

1. **开发环境专用**：此功能仅在开发模式下可用
2. **本地访问**：预览服务器仅绑定到本地地址
3. **文件权限**：确保故事文件具有读取权限
4. **端口占用**：确保端口 3001 和 5173 可用

## 高级用功能

### 测试模式
访问 `http://localhost:3001/preview?test=true` 可以启用测试模式，显示示例内容。

### 自定义样式
浏览器预览使用内联CSS，可以通过修改 `electron/main.ts` 中的样式自定义外观。

### 移动端优化
预览页面已针对移动设备进行优化，支持触摸交互和响应式布局。