# Inklecate错误高亮测试指南

## 测试准备

1. 启动开发环境：
```bash
npm run dev
```

2. 在编辑器中打开测试文件：`story/test-errors.ink`

## 功能测试步骤

### 1. 基本错误高亮测试

**测试内容：** 各种语法错误是否正确高亮

**步骤：**
1. 在编辑器中打开 `story/test-errors.ink`
2. 等待2-3秒让语法检测完成
3. 检查以下错误是否被正确高亮：

**预期错误高亮：**
- 第6行：`-> nonexistent_knot` （未定义的跳转目标）
- 第10行：`"hello world` （未闭合字符串）
- 第14行：`{undefined_variable}` （未定义变量）
- 第17行：空的选择项 `*`
- 第22行：`=== 123invalid_knot_name ===` （无效knot名称）
- 第27行和第31行：`=== duplicate_test ===` （重复定义）
- 第36行：`INCLUDE nonexistent_file.ink` （文件不存在）

### 2. 警告显示测试

**测试内容：** 警告是否以不同颜色显示

**步骤：**
1. 查看第40行：`-> warning_test` （可能的无限循环）
2. 查看第43行：`* (unused_label)` （未使用的标签）

**预期结果：**
- 警告应该以黄色/橙色波浪线显示
- 错误应该以红色波浪线显示

### 3. 实时错误检测测试

**测试内容：** 编辑时错误高亮的实时更新

**步骤：**
1. 在文件末尾添加新的错误代码：
```ink
=== test_realtime ===
-> another_nonexistent_target
```
2. 等待500ms（防抖延迟）
3. 检查新的错误是否被高亮

**预期结果：**
- 新的跳转错误应该被实时标记

### 4. 错误修复测试

**测试内容：** 修复错误后高亮是否消失

**步骤：**
1. 修复一个错误，例如将第6行改为：`-> syntax_errors`
2. 等待500ms
3. 检查错误高亮是否消失

**预期结果：**
- 修复后的行不应该再有错误高亮

### 5. 悬停提示测试

**测试内容：** 鼠标悬停时是否显示错误详情

**步骤：**
1. 将鼠标悬停在任何有错误高亮的位置
2. 检查是否显示错误信息工具提示

**预期结果：**
- 应该显示详细的错误信息
- 信息前缀应该是 `[inklecate]` 或 `[编译器]`

### 6. 文件路径一致性测试

**测试内容：** 确保错误报告的文件名与当前编辑文件一致

**步骤：**
1. 重命名 `test-errors.ink` 为 `renamed-test.ink`
2. 在编辑器中重新打开重命名的文件
3. 检查错误高亮是否正常工作

**预期结果：**
- 错误高亮应该正常工作
- 控制台中不应该有文件路径相关的错误

### 7. INCLUDE语法测试

**测试内容：** INCLUDE语法的错误检测

**步骤：**
1. 创建一个有效的被包含文件：
```bash
echo "=== included_knot ===" > story/valid_include.ink
echo "This is included content." >> story/valid_include.ink
echo "-> END" >> story/valid_include.ink
```

2. 在测试文件中添加：
```ink
INCLUDE valid_include.ink
-> included_knot
```

3. 检查是否没有错误高亮

**预期结果：**
- 有效的INCLUDE应该不显示错误
- 跳转到included_knot应该不显示错误

### 8. Graph编译错误传递测试 ⭐

**测试内容：** NodeGraph编译错误是否会反映在Editor中

**步骤：**
1. 在编辑器中打开 `story/test-graph-errors.ink`
2. 确保右侧面板显示NodeGraph视图
3. 等待Graph编译完成（应该失败）
4. 观察编辑器中是否出现错误高亮

**预期结果：**
- 第5行：`-> nonexistent_target_for_graph` 应该显示红色错误高亮
- 错误信息应该来自Graph编译过程
- 错误应该与直接在Editor中编辑触发的错误格式一致

**高级测试：**
1. 修复错误（将跳转目标改为`working_knot`）
2. 等待Graph重新编译
3. 检查错误高亮是否消失

**调试提示：**
- 在浏览器控制台中查看 "Graph编译错误" 相关日志
- 确认InkContext.reportCompilationErrors被正确调用

## 调试信息

### 查看控制台日志

在浏览器开发者工具中查看：
1. Monaco Editor相关的错误标记
2. Inklecate编译输出
3. 错误解析过程

### 常见问题排查

1. **错误高亮不显示：**
   - 检查是否等待了足够的防抖时间（500ms）
   - 查看控制台是否有编译错误
   - 确认inklecate路径是否正确

2. **文件路径错误：**
   - 确认文件确实存在于指定路径
   - 检查文件权限

3. **高亮位置不准确：**
   - 这可能是错误解析器的定位逻辑问题
   - 查看控制台中的错误解析输出

## 性能测试

### 大文件测试

**步骤：**
1. 创建一个包含500-1000行的大型Ink文件
2. 在其中插入各种错误
3. 测试语法检测的响应速度

**预期结果：**
- 语法检测应该在2秒内完成
- UI不应该卡顿

### 频繁编辑测试

**步骤：**
1. 快速连续编辑文件（每秒多次更改）
2. 观察错误高亮的更新情况

**预期结果：**
- 防抖机制应该避免过于频繁的编译
- 最终的错误高亮应该是准确的

## 验收标准

✅ 所有语法错误都能被正确识别和高亮
✅ 警告和错误有不同的视觉表现
✅ 错误位置定位准确（精确到具体的语法元素）
✅ 实时更新响应及时（500ms内）
✅ 错误修复后高亮及时消失
✅ 悬停提示显示详细信息
✅ 文件路径处理正确
✅ INCLUDE语法支持正常
✅ 性能表现良好